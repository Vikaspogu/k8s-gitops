---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: papra
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: papra-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        AUTH_SECRET: "{{.AUTH_SECRET}}"
        DOCUMENT_STORAGE_S3_ACCESS_KEY_ID: "{{.ACCESS_KEY}}"
        DOCUMENT_STORAGE_S3_SECRET_ACCESS_KEY: "{{.SECRET_ACCESS}}"
        DOCUMENT_STORAGE_S3_BUCKET_NAME: papra
        DOCUMENT_STORAGE_S3_REGION: garage
        DOCUMENT_STORAGE_S3_ENDPOINT: s3.synlo.duckdns.org:3900
        AUTH_PROVIDERS_CUSTOMS: '[
            {
              "providerId": "authentik",
              "providerName": "Authentik",
              "providerIconUrl": "https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons/svg/authentik.svg",
              "clientId": "{{ .CLIENT_ID }}",
              "clientSecret": "{{ .CLIENT_SECRET }}",
              "type": "oidc",
              "discoveryUrl": "https://id.${SECRET_DOMAIN}/application/o/papra/.well-known/openid-configuration",
              "scopes": ["openid", "profile", "email"]
            }
          ]'
  dataFrom:
    - extract:
        key: papra
